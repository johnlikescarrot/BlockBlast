name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      - name: Setup Node.js âš™ï¸
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install Dependencies ğŸ”§
        run: npm install

      - name: Build ğŸ—ï¸
        run: npm run build

      - name: Post-Build Asset Copy ğŸ“‚
        run: |
          # The index.html references ./src/style.css, so we need to ensure it exists in the dist folder
          mkdir -p dist/src
          cp src/style.css dist/src/style.css
          
          # Copy assets (images/audios) to dist/src in case the game tries to load them relatively
          # (Even if isProd=true uses external URLs, this ensures local fallbacks work if configured)
          if [ -d "src/images" ]; then cp -r src/images dist/src/; fi
          if [ -d "src/audios" ]; then cp -r src/audios dist/src/; fi

      - name: Deploy to GitHub Pages ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: dist
          branch: gh-pages
